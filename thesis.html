<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>thesis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="thesis_files/libs/clipboard/clipboard.min.js"></script>
<script src="thesis_files/libs/quarto-html/quarto.js"></script>
<script src="thesis_files/libs/quarto-html/popper.min.js"></script>
<script src="thesis_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="thesis_files/libs/quarto-html/anchor.min.js"></script>
<link href="thesis_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="thesis_files/libs/quarto-html/quarto-syntax-highlighting-e26003cea8cd680ca0c55a263523d882.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="thesis_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="thesis_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="thesis_files/libs/bootstrap/bootstrap-d621a49e4ac292b7987af0084906fd62.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block"></header>




<hr>
<hr>
<p>title: “thesis” author: “Dimitris Papachristopoulos” format: pdf: default #logo: ./figure/ arxiv-pdf: keep-tex: true<br>
link-citations: true link-bibliography: true toc: true toc-depth: 3 theme: minti bibliography: ./My_Library.bib execute: echo: false eval: true warning: false editor: visual</p>
<hr>
<div style="page-break-after: always;"></div>
<section id="abstract" class="level1">
<h1>Abstract</h1>
<p>The Star Formation History (SFH) of a galaxy can offer many insights not only for the evolution and the future of the galaxy, but also for the evolution of the Universe. This is why there are various theoretical models trying to describe the SFH of galaxies. One of those models is the Delayed-Tau model, which approximates the Star Formation Rates (SFR) of galaxies as a function with a rising SFR at the beginning, until it reaches a peak at a time <span class="math inline">\(\tau\)</span>, unique for each galaxy, and then it drops at an exponential rate.</p>
<p><span class="citation" data-cites="haslbauerCosmologicalStarFormation2023">@haslbauerCosmologicalStarFormation2023</span> argue that the Delayed-<span class="math inline">\(\tau\)</span> model is opposed to the Lilly-Madau plot (<span class="citation" data-cites="madauCosmicStarFormation2014">[@madauCosmicStarFormation2014]</span>), which plots the observed SFR’s of galaxies with the corresponding redshifts (<span class="math inline">\(z\)</span>) and calculates a cosmic SFR peak at <span class="math inline">\(z\approx 2\)</span>. The way they calculated this inconsistency is by using observatory data for SFR and Stellar Masses <a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> from the UNGC catalog (<span class="citation" data-cites="karachentsevUPDATEDNEARBYGALAXY2013">@karachentsevUPDATEDNEARBYGALAXY2013</span>, <span class="citation" data-cites="karachentsevSTARFORMATIONPROPERTIES2013">@karachentsevSTARFORMATIONPROPERTIES2013</span>) for calculating the parameters (the timescale <span class="math inline">\(\tau\)</span> and the normalization constant <span class="math inline">\(A_{del}\)</span>) of the model. This calculation for the galaxies of the Local Cosmological Volume (LCV), allows the investigation of the SFR throughout the life each galaxy and so we can find the expected time of peak of the SFR.</p>
<p>In this thesis project, we will try to calculate the same parameters, by using a bigger sample size and the method Markov Chain Monte Carlo, to examine if the inconsistencies of the model derive from the results of the previous analysis, or if it is an intrinsic problem of the model</p>
<p><strong>Keywords:</strong> Galaxies, Galaxy Evolution, Star Formation History (SFH), Star Formation Rate (SFR), Delayed-<span class="math inline">\(\tau\)</span>, Local Cosmological Volume, Lilly-Madau Plot, Redshift, Markov Chain Monte Carlo (MCMC).</p>
<div style="page-break-after: always;"></div>
</section>
<section id="galaxy-morphology-and-star-forming-regions" class="level1">
<h1>Galaxy Morphology and Star-Forming Regions</h1>
<p>This thesis will focus on how a specific parametric model tries to explain the Star-Formation Histories of galaxies, but to do that, we first need to understand what a galaxy is, what it is made of, the mechanisms of its evolution, and how we can distinguish them.</p>
<p>The study of galaxies is a very active field of astronomy since it is a relatively young discipline. Until 1920, astronomers who observed spiral nebulae were not certain what they were. In 1921, two papers were published: one argued that the Milky Way constituted the whole Universe and that the spiral nebulae were part of it, while the second argued that each spiral nebula was, in fact, a distinct “island universe” <span class="citation" data-cites="shapleyScaleUniverse1921">[@shapleyScaleUniverse1921]</span>. This debate became known as the Great Debate<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>.</p>
<p>In 1925, Edwin Hubble put an end to the debate by showing that the distances to the spiral nebulae were far too great compared to other objects within the Milky Way. The method he used involved observing Cepheid variable stars in these nebulae. By applying the period-luminosity relationship, which had been discovered by Henrietta Swan Leavitt <span class="citation" data-cites="leavitt1777VariablesMagellanic1907">[@leavitt1777VariablesMagellanic1907]</span>, Hubble was able to determine their distances. This groundbreaking discovery confirmed that spiral nebulae were indeed separate galaxies, marking the beginning of extragalactic astronomy and revolutionizing our understanding of the Universe.</p>
<p>Today we know that galaxies are large-scale structures containing, Stars, gas and dust, Stellar and planetary systems and Stellar remnants (white dwarves, neutron stars and black holes). Those structures are held together by their gravity, having Stellar Masses more than <span class="math inline">\(\sim 10^5\ M_\odot\)</span>, and an average diameter of <span class="math inline">\(\sim 4\ \text{kpc}\)</span>. They are extremely diverse systems, and each galaxy differs in mass, size, brightness, stellar populations and morphology. This is exactly why we have created systems to classify them.</p>
<section id="galaxy-classification" class="level2">
<h2 class="anchored" data-anchor-id="galaxy-classification">Galaxy Classification</h2>
<p>The most common method of classification is the <em>Hubble-de Vacouleur</em> classification, which categorizes galaxies based on their morphology.</p>
<ul>
<li><p><strong>Elliptical Galaxies (E):</strong> Ellipsoidal shapes with smooth brightness profiles, containing older stars and minimal interstellar matter. Their eccentricity takes values from 0 to 0.7, so we can categorize them even further, form E0 to E7</p></li>
<li><p><strong>Lenticular Galaxies (S0):</strong> Intermediate between elliptical and spiral galaxies,</p></li>
<li><p><strong>Spiral Galaxies:</strong> Characterized by a central bulge and spiral arms. Depending on the arm tightness we can categorize them as <em>a,b,c,d</em> from tight to looser, and depending if they have a bar or not they are subdivided into:</p>
<ul>
<li><p><strong>Unbarred Spirals (S):</strong> No central bar; classified as Sa, Sb, Sc, etc., based on arm tightness and bulge size.</p></li>
<li><p><strong>Barred Spirals (SB):</strong> Feature a central bar; denoted as SBa, SBb, SBc, etc.</p></li>
</ul></li>
<li><p><strong>Irregular Galaxies (Irr):</strong> Lack regular structure, often rich in gas and dust with high star formation rates.</p></li>
</ul>
<p>Intermediate galaxies between ellipticals and spirals are called <strong>Lenticular galaxies (S0-SB0)</strong>, featuring a central bulge and disk but lacking significant spiral structure.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="https://commons.wikimedia.org/w/index.php?curid=121743256"><img src="figure/1311px-Hubble_Tuning_Fork_diagram.svg.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="400" alt="Tuning-fork-style diagram of the Hubble sequenceBy Cosmogoblin - Own work, CC0, https://commons.wikimedia.org/w/index.php?curid=121743256"></a></p>
</figure>
</div>
<figcaption>Tuning-fork-style diagram of the Hubble sequenceBy Cosmogoblin - Own work, CC0, https://commons.wikimedia.org/w/index.php?curid=121743256</figcaption>
</figure>
</div>
<table class="caption-top table">
<caption>This table was based on the files of <span class="citation" data-cites="RC3ThirdReference">[@RC3ThirdReference]</span></caption>
<colgroup>
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;"><strong>Hubble</strong></th>
<th style="text-align: center;">E</th>
<th style="text-align: center;">E-S0</th>
<th style="text-align: center;">S0</th>
<th style="text-align: center;">S0/a</th>
<th style="text-align: center;">Sa</th>
<th style="text-align: center;">Sa-b</th>
<th style="text-align: center;">Sb</th>
<th style="text-align: center;">Sb-c</th>
<th style="text-align: center;">Sc</th>
<th style="text-align: center;">Sc-Irr</th>
<th style="text-align: center;">Irr</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>T</strong></td>
<td style="text-align: center;">-5</td>
<td style="text-align: center;">[-4,-3]</td>
<td style="text-align: center;">[-2,-1]</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">[5,6,7]</td>
<td style="text-align: center;">8</td>
<td style="text-align: center;">[9,10,11]</td>
</tr>
</tbody>
</table>
<section id="dwarf-galaxies" class="level3">
<h3 class="anchored" data-anchor-id="dwarf-galaxies">Dwarf Galaxies</h3>
</section>
</section>
<section id="star-forming-regions" class="level2">
<h2 class="anchored" data-anchor-id="star-forming-regions">Star-Forming Regions</h2>
</section>
</section>
<section id="star-formation-history-sfh" class="level1">
<h1>Star Formation History (SFH)</h1>
<p>The SFH of a galaxy describes the evolution of its star formation rate over time. By selecting an appropriate model for SFH, we can analyze stellar production, predict periods of active or quiescent star formation, and determine when SFR stabilizes.</p>
<p>Understanding SFH models is crucial for interpreting internal and external processes affecting galaxies and identifying conditions for intense star formation in their early stages.</p>
<section id="star-formation-rate" class="level2">
<h2 class="anchored" data-anchor-id="star-formation-rate">Star Formation Rate</h2>
<p>The star formation rate (SFR) is defined as the total gas mass of a galaxy converted into stars over a specific time interval. It is typically expressed in solar masses per year (<span class="math inline">\(M_\odot \cdot \text{yr}^{-1}\)</span>).</p>
<p>The SFR varies significantly over time, and its integration over time provides the total stellar mass formed during the galaxy’s history of star formation. Specifically:</p>
<p><span id="eq-sfr_int"><span class="math display">\[
\int_0^{t_{sf}} \text{SFR}(t)dt = \zeta M_*(t_{sf}),\ t_{sf}=\text{Time of Star Formation,}
\tag{1}\]</span></span></p>
<p>where <span class="math inline">\(\zeta\)</span> accounts for mass loss during the Star Formation and is approximately <span class="math inline">\(\zeta \approx 1.3\)</span> (<span class="citation" data-cites="kroupaConstraintsStarFormation2020">@kroupaConstraintsStarFormation2020</span>).</p>
<section id="estimating-sfr-from-spectra" class="level3">
<h3 class="anchored" data-anchor-id="estimating-sfr-from-spectra">Estimating SFR from Spectra</h3>
<p>SFR can be estimated using various photometric or spectroscopic methods based on the luminosity of at least one spectral band or the intensity of a spectral line. Different luminosities and intensities trace distinct emission mechanisms, offering insights into a galaxy’s radiation sources. Below are common methods:<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></p>
<ul>
<li><p><strong>Hα</strong> <span class="math inline">\(\alpha\)</span> <strong>Emission</strong>: Young, hot, massive stars (O-type stars, ~10 Myr, ~20 <span class="math inline">\(M_\odot\)</span>) produce a number of ionizing photons, which they ionize the surrounding hydrogen rich gas. The hydorgen undergoes recombination cascades which produce Balmer emission lines of <span class="math inline">\(H\alpha\)</span> (0.6563 <span class="math inline">\(\mu m\)</span>) and <span class="math inline">\(H\beta\)</span> (0.4861 <span class="math inline">\(\mu m\)</span>). Dust can significantly affect observations.</p></li>
<li><p><strong>Far-Ultraviolet (FUV) Flux</strong>: Mainly emitted by young, hot stars ( B-type stars, ~100 Myr). Dust presence can also significantly affect observations.</p></li>
<li><p><strong>Infrared (IR) Flux</strong>: The stars in a galaxy can heat up the dust in different ways, which then emits radiation in different parts of the IR spectrum. For example, young and massive, short-lived stars, emit UV radiation which then the heated dust emits in a wavelength of <span class="math inline">\(\approx 60 \mu m\)</span>, whereas dust heated by UV-faint old or low-mass stars will emit at <span class="math inline">\(\approx 100-150\mu m\)</span>. As a result, the total IR emission is age-agnostic and provides a more accurate approximation of the SFR because it accounts for contributions from both young and old stellar populations.</p></li>
<li><p><strong>Radio Continuum Emission</strong>: Strongly correlated with IR. Its origin is complex, involving synchrotron radiation from relativistic electrons and thermal Bremsstrahlung from hot gas.</p></li>
<li><p><strong>X-Ray Emission</strong>: In star-forming galaxies, X-rays arise from high-mass binary systems (neutron star or black hole with massive stellar companion) and hot gas from supernovae, correlating with SFR up to redshift <span class="math inline">\(z \sim 4\)</span>. X-rays are dust-insensitive, enabling accurate high-redshift observations.</p></li>
</ul>
<p>SFR for different luminosities <span class="math inline">\(L_i\)</span> can be calculated as:</p>
<p><span id="eq-sfr-spectra"><span class="math display">\[
\text{SFR}_i = \mathcal{K}_i\times L_i
\tag{2}\]</span></span></p>
<p>where <span class="math inline">\(\mathcal{K}_i\)</span> is a constant specific to each <span class="math inline">\(L_i\)</span> (<span class="math inline">\(i =\)</span> H<span class="math inline">\(\alpha\)</span>, IR, radio, FUV, X). In our analysis, we lack radio and X-ray data.</p>
<p>Since the luminosities <span class="math inline">\(L_{\text{FUV}}\)</span> and <span class="math inline">\(L_{\text{H}\alpha}\)</span> originate from young stars and are highly sensitive to dust, we either directly observe stars unaffected by dust or use correction models to account for dust absorption. It is crucial to ensure that these models neither underestimate nor overestimate the luminosities by overlooking or double-counting the same sources.</p>
<p>Additionally, because these luminosities are emitted by similar stellar populations, we can reasonably expect the <span class="math inline">\(SFR_{\text{FUV}}\)</span> and <span class="math inline">\(SFR_{\text{H}\alpha}\)</span> to be approximately equal. As shown in the data from <span class="citation" data-cites="karachentsevSTARFORMATIONPROPERTIES2013">[@karachentsevSTARFORMATIONPROPERTIES2013]</span> and supported by <span class="citation" data-cites="kroupaConstraintsStarFormation2020">[@kroupaConstraintsStarFormation2020]</span>, a suitable approach for estimating the total SFR from FUV and H<span class="math inline">\(\alpha\)</span> observations is to calculate their average:</p>
<p><span id="eq-SFR_comb"><span class="math display">\[
SFR_{\text{FUV},H\alpha} = \text{mean}(SFR_{\text{FUV}}, SFR_{\text{H}\alpha})
\tag{3}\]</span></span></p>
<p>where <span class="math inline">\(L_{\text{FUV}}\)</span> and <span class="math inline">\(L_{\text{H}\alpha}\)</span> are corrected for dust attenuation.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figure/log_SFR_FUV_Ha.png" class="img-fluid figure-img" width="500"></p>
<figcaption>Plot showing the linear relation <span class="math inline">\(\log_{10}\text{SFR}_{FUV} = \log_{10}\text{SFR}_{H\alpha}\)</span>, as well as their distrubutions</figcaption>
</figure>
</div>
<p>According to <span class="citation" data-cites="madauCosmicStarFormation2014">[@madauCosmicStarFormation2014]</span>, this method often underestimates the SFR, since different galaxy populations may systematically follow distinct absorption mechanisms depending on their characteristics.</p>
<p>Since <span class="math inline">\(SFR_{\text{FUV}}\)</span>, based on the uncorrected <span class="math inline">\(L_{FUV}\)</span>, represents the emission from unobstructed stellar populations, and <span class="math inline">\(SFR_{TIR}\)</span> isaccounts for dust-reprocessed light, a more accurate way to calculate the total SFR of a galaxy is:</p>
<p><span id="eq-SFR_tot_madau"><span class="math display">\[
SFR_{\text{total}} = \mathcal{K}_{\text{FUV}} \cdot L_{\text{FUV}} + \mathcal{K}_{\text{IR}} \cdot L_{\text{IR}}
\tag{4}\]</span></span></p>
<p>Following the same reasoning as the previous formula, the total SFR can be expressed as:</p>
<p><span class="math display">\[
SFR_{\text{total}} = \text{mean}\left(\mathcal{K}_{\text{FUV}} \cdot L_{\text{FUV}}, \mathcal{K}_{\text{H}\alpha} \cdot L_{\text{H}\alpha}\right) + \mathcal{K}_{\text{IR}} \cdot L_{\text{IR}} \\
= SFR_{\text{FUV},H\alpha}+ SFR_{\text{IR}}
\]</span></p>
<p>where <span class="math inline">\(L_{\text{FUV}}\)</span> and <span class="math inline">\(L_{\text{H}\alpha}\)</span> are not corrected for dust absorption. However, since we do not have enough galaxies with both traces, we will use a different method of calculating the total SFR, which we will discuss later.</p>
</section>
</section>
<section id="main-sequence-galaxies" class="level2">
<h2 class="anchored" data-anchor-id="main-sequence-galaxies">Main Sequence Galaxies</h2>
<p>The SFR and stellar mass of a galaxy are tightly correlated by the relationship:</p>
<p><span class="math display">\[
\log(\text{SFR}) = \alpha \log(M_*)+\beta
\]</span></p>
<p>where <span class="math inline">\(\alpha(t)\)</span> and <span class="math inline">\(\beta(t)\)</span> depend on time and redshift <span class="math inline">\(z\)</span> (<span class="citation" data-cites="speagleHighlyConsistentFramework2014">@speagleHighlyConsistentFramework2014</span>):</p>
<section id="star-formation-history-models" class="level3">
<h3 class="anchored" data-anchor-id="star-formation-history-models">Star Formation History Models</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(latex2exp)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Define time values (positive times)</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.01</span>, <span class="dv">12</span>, <span class="at">length.out =</span> <span class="dv">200</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Define SFR models</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>exponential_decline <span class="ot">&lt;-</span> <span class="cf">function</span>(t, tau) <span class="fu">exp</span>(<span class="sc">-</span>t <span class="sc">/</span> tau)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>delayed_exponential <span class="ot">&lt;-</span> <span class="cf">function</span>(t, tau) t <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>t <span class="sc">/</span> tau)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>log_normal <span class="ot">&lt;-</span> <span class="cf">function</span>(t, tau, T0) (<span class="dv">1</span> <span class="sc">/</span> tau) <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>((<span class="fu">log</span>(t) <span class="sc">-</span> <span class="fu">log</span>(T0))<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> tau<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>double_power_law <span class="ot">&lt;-</span> <span class="cf">function</span>(t, tau, alpha, beta) <span class="dv">1</span> <span class="sc">/</span> ((t <span class="sc">/</span> tau)<span class="sc">^</span>alpha <span class="sc">+</span> (t <span class="sc">/</span> tau)<span class="sc">^</span>(<span class="sc">-</span>beta))</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate data for each model</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">t =</span> <span class="fu">rep</span>(t, <span class="dv">4</span>),</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">SFR =</span> <span class="fu">c</span>(</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">exponential_decline</span>(t, <span class="at">tau =</span> <span class="dv">2</span>),</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">delayed_exponential</span>(t, <span class="at">tau =</span> <span class="dv">2</span>),</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">log_normal</span>(t, <span class="at">tau =</span> <span class="dv">2</span>, <span class="at">T0 =</span> <span class="dv">10</span>),</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">double_power_law</span>(t, <span class="at">tau =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="dv">2</span>, <span class="at">beta =</span> <span class="dv">5</span>)</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">Model =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Exponential Decline</span><span class="sc">\n</span><span class="st">(τ=2 Gyr)"</span>, <span class="st">"</span><span class="sc">\n</span><span class="st">Delayed Exponential</span><span class="sc">\n</span><span class="st">(τ=2 Gyr)"</span>, <span class="st">"</span><span class="sc">\n</span><span class="st">Log-Normal</span><span class="sc">\n</span><span class="st">(τ = 2 Gyr, To = 10 Gyr)"</span>, <span class="st">"</span><span class="sc">\n</span><span class="st">Double Power Law</span><span class="sc">\n</span><span class="st">(τ = 2 Gyr, α = 2, β = 5)"</span>), <span class="at">each =</span> <span class="fu">length</span>(t))</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot all models</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> t, <span class="at">y =</span> SFR, <span class="at">color =</span> Model)) <span class="sc">+</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Star Formation Rate Models"</span>,</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">TeX</span>(<span class="st">"Star Formation time ( $t_{sf}$ ) [Gyr]"</span>),</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">TeX</span>(<span class="st">"SFR($t_{sf}$) [ M$_*$/yr ]"</span> ),</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Model"</span></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">12</span>)) <span class="sc">+</span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="thesis_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Star Formation Rate over the time of star formation, for different parametric models</figcaption>
</figure>
</div>
</div>
</div>
<p>Parameterized SFH models are commonly used, offering simplicity through a few parameters <span class="citation" data-cites="carnallHowMeasureGalaxy2019a">[@carnallHowMeasureGalaxy2019a]</span>:</p>
<ul>
<li><strong>Exponential Decline (Tau Model):</strong> The star formation rate (SFR) decreases exponentially over time, following the equation:</li>
</ul>
<p><span class="math display">\[
  \text{SFR}(t) \propto e^{-t_{\text{sf}}/\tau}
\]</span></p>
<p>where <span class="math inline">\(\tau\)</span> is the timescale, <span class="math inline">\(t_{\text{sf}} = t - T_0\)</span> is the star formation time, <span class="math inline">\(t\)</span> is the age of the Universe, and <span class="math inline">\(T_0\)</span> is the time when star formation began.</p>
<ul>
<li><strong>Delayed Exponential (Delayed Tau Model):</strong> This model provides a more complex representation where the SFR initially increases, reaches a peak, and then declines exponentially over time. The equation for this model is:</li>
</ul>
<p><span class="math display">\[
  \text{SFR}(t) \propto t_{\text{sf}} e^{-t_{\text{sf}}/\tau}
\]</span></p>
<p>This accounts for an initial growth phase followed by a decline. In this case, <span class="math inline">\(\tau\)</span> represents the time it takes for the galaxy to reach <span class="math inline">\(\text{SFR}_{\text{max}}\)</span>.</p>
<ul>
<li><strong>Log-Normal Distribution Model:</strong> The SFR follows a normalized log-normal distribution, which can accurately model the star formation rate density (<span class="math inline">\(\text{SFRD} = \text{SFR}/M_*\)</span>) in individual galaxies. The general form of the equation is:</li>
</ul>
<p><span class="math display">\[
  \text{SFR}(t) \propto \frac{1}{\tau} \exp\left(-\frac{(\ln(t) - T_0)^2}{2\tau^2}\right)
\]</span></p>
<p>where <span class="math inline">\(\tau\)</span> and <span class="math inline">\(T_0\)</span> are free parameters of the distribution that lack physical significance, as the SFR does not necessarily peak at <span class="math inline">\(t = e^{T_0}\)</span>.</p>
<ul>
<li><strong>Double Power Law:</strong> This model describes a scenario where the SFR rises and then falls sharply, useful for modeling galaxies experiencing rapid changes in star formation. The equation is:</li>
</ul>
<p><span class="math display">\[
  \text{SFR}(t) \propto \left[\left(\frac{t}{\tau}\right)^\alpha + \left(\frac{t}{\tau}\right)^\beta\right]^{-1}
\]</span></p>
<p>where <span class="math inline">\(\tau\)</span> is the timescale and <span class="math inline">\(\alpha\)</span>, <span class="math inline">\(\beta\)</span> are exponents that govern the rise and fall of the SFR.</p>
<p>Additionally, there are non-parametric models, which do not follow a specific functional form to describe the star formation of a galaxy. These models are more flexible in adapting to galaxies with more complex star formation patterns.</p>
</section>
</section>
<section id="delayed-τ-model" class="level2">
<h2 class="anchored" data-anchor-id="delayed-τ-model">Delayed-<span class="math inline">\(τ\)</span> Model</h2>
<p>The delayed <span class="math inline">\(τ\)</span> model is widely used for describing an initial starburst followed by a gradual decline in SFR. This places galaxies on the main sequence. It is particularly effective for massive galaxies (<span class="citation" data-cites="haslbauerCosmologicalStarFormation2023">@haslbauerCosmologicalStarFormation2023</span>). However, it assumes smooth SFR evolution and may overestimate peak SFR in high-redshift galaxies.</p>
<p>Using the delayed τ model, we compute <span class="math inline">\(\tau\)</span>, <span class="math inline">\(t_{\text{sf}}\)</span>, and normalization constant <span class="math inline">\(A_{\text{del}}\)</span> with:</p>
<p><span id="eq-delayed-current"><span class="math display">\[
\text{SFR}_0 = \text{SFR}(t_{sf}) = A_{del}\frac{t_{sf}}{\tau^2}e^{-t_{sf}/\tau}
\tag{5}\]</span></span></p>
<p>where <span class="math inline">\(\text{SFR}_0\)</span> is given in the catalogs.</p>
</section>
</section>
<section id="lilly-madau-plot" class="level1">
<h1>Lilly-Madau Plot</h1>
<p>The Lilly-Madau plot is one of the most important plots in the field of galaxy evolution. It describes how the SFRD of the universe evolved over time, with observational data. But to understand it, we first need to understand how the observed age of the Universe and the redshifts of galaxies are related.</p>
<section id="redshift-and-lookback-time" class="level2">
<h2 class="anchored" data-anchor-id="redshift-and-lookback-time">Redshift and lookback time</h2>
<p>According to Hubble–Lemaître law, all the galaxies are moving away from each other, at a speed proportional to their distance, due to the expansion of the universe.</p>
<p><span class="math inline">\(V = H_0\times d\)</span>, where <span class="math inline">\(H_0 \approx 69.8 \text{ km/s/Mpc}\)</span> is the Hubble constant and <span class="math inline">\(d\)</span> is the distance between the two galaxies.<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a></p>
<p>Since we have galaxies with relative motions emitting light waves, we can observe the Doppler effect. Specifically, since the galaxies are moving away from each other, and thus from us also, we observe radiation with longer wavelenghts.</p>
<p><em>Redshift</em> (<span class="math inline">\(z\)</span>) is the doppler shift resulting from radial motion:</p>
<p><span class="math display">\[
z = \frac{\lambda_{observed}}{\lambda_{emitted}}-1
\]</span></p>
<p>In special relativity, <span class="math inline">\(z\)</span> is related to radial velocity <span class="math inline">\(v\)</span> by <span class="citation" data-cites="hoggDistanceMeasuresCosmology2000">[@hoggDistanceMeasuresCosmology2000]</span></p>
<p><span id="eq-z-rel"><span class="math display">\[
1+z = \sqrt{\frac{1+v/c}{1-v/c}}
\tag{6}\]</span></span> For small <span class="math inline">\(v/c\)</span> we can rewrite <a href="#eq-z-rel" class="quarto-xref">Equation&nbsp;6</a>, as:</p>
<p><span class="math display">\[
z \approx \frac{V}{c} = \frac{H_0\times d}{c}
\]</span></p>
<p>But, because light takes time to cover the distance <span class="math inline">\(d\)</span> between two galaxies, when the light finally reaches as, we will see the observed galaxy, as it was when the light was emitted, and not how it is at this moment. If we substitute time that it took the light to reach us over the distance, then we arrive at the relation <span class="citation" data-cites="longairGalaxyFormation1998">[@longairGalaxyFormation1998]</span>:</p>
<p><span class="math display">\[
t_\text{emitted} \propto z^{-3/2}
\]</span></p>
<p><em>The lookback time</em> is the difference between the current age of the Universe and the age of the Universe when the light was emitted</p>
<p><span class="math display">\[
t_L = T_0-t_\text{emitted}
\]</span></p>
</section>
<section id="lilly-madau-plot-1" class="level2">
<h2 class="anchored" data-anchor-id="lilly-madau-plot-1">Lilly-Madau Plot</h2>
</section>
</section>
<section id="delayed-tau-model" class="level1">
<h1>Delayed-<span class="math inline">\(\tau\)</span> model</h1>
</section>
<section id="computational-methods" class="level1">
<h1>Computational Methods</h1>
<section id="newton-raphson" class="level2">
<h2 class="anchored" data-anchor-id="newton-raphson">Newton-Raphson</h2>
</section>
<section id="markov-chain-monte-carlo" class="level2">
<h2 class="anchored" data-anchor-id="markov-chain-monte-carlo">Markov Chain Monte Carlo</h2>
</section>
</section>
<section id="prepering-the-catalogs" class="level1">
<h1>Prepering the Catalogs</h1>
<p>UNGC HECATE join etc…</p>
<section id="catalog-completeness" class="level2">
<h2 class="anchored" data-anchor-id="catalog-completeness">Catalog Completeness</h2>
</section>
<section id="comparing-the-catalogs" class="level2">
<h2 class="anchored" data-anchor-id="comparing-the-catalogs">Comparing the Catalogs</h2>
</section>
<section id="the-special-case-of-the-star-formation-rates" class="level2">
<h2 class="anchored" data-anchor-id="the-special-case-of-the-star-formation-rates">The “special” case of the Star Formation Rates</h2>
</section>
</section>
<section id="calculating-the-parameters" class="level1">
<h1>Calculating the parameters</h1>
<section id="according-to-pre-existing-bibliography" class="level2">
<h2 class="anchored" data-anchor-id="according-to-pre-existing-bibliography">According to pre-existing bibliography</h2>
<section id="problems-with-the-method" class="level3">
<h3 class="anchored" data-anchor-id="problems-with-the-method">Problems with the method</h3>
</section>
</section>
<section id="mcmc" class="level2">
<h2 class="anchored" data-anchor-id="mcmc">MCMC</h2>
</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>They calculated the Stellar Masses by using a Mass to Light ratio of 0.6<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p><span class="citation" data-cites="hoskinGreatDebateWhat1976">@hoskinGreatDebateWhat1976</span><a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p><span class="citation" data-cites="calzettiStarFormationRate2012">@calzettiStarFormationRate2012</span>, <span class="citation" data-cites="mushotzkyASTR620GalaxiesFall2017">@mushotzkyASTR620GalaxiesFall2017</span><a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>We also have non-Hubble motions <span class="math inline">\(V = H_0\times d + V_0\)</span>, where <span class="math inline">\(V_0\)</span> is the peculiar velocity and it could, for example, be due to galaxy cluster dynamics. For the current explanation we are going to ignore it. This way the radial velocity <span class="math inline">\(v\)</span> is equal to <span class="math inline">\(V\)</span><a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>